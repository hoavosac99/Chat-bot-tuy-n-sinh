(this["webpackJsonprasa-frontend"]=this["webpackJsonprasa-frontend"]||[]).push([[5],{1595:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return P}));var r=n(0),a=n.n(r),l=n(72),o=n(21),c=n(23),s=n(68),i=n(43),u=n(1),m=n(96),d=n(50),f=n(3),E=n(8),h=n(30),v=n(166),b=n(26);function p(e){var t=e.roles,n=e.users,a=e.total,l=e.onLoadMoreRows,o=e.onEdit,c=e.onDelete,s=r.useCallback((function(e){var t=e.dataSelected,n=e.setSelected,a=t.filter((function(e){return e.users_count&&e.users_count>0})).length;return r.createElement(f.Box,null,r.createElement(h.a,{resource:E.d.Roles,action:E.a.Delete,yes:r.createElement(b.a,{content:a>0?"Cannot perform delete because ".concat(1===a?"the selected role still has":"".concat(a," selected roles still have")," users assigned"):"Delete"},r.createElement(u.d,{variant:"inverse",disabled:a>0,onClick:function(){c(t),n([])}},"Delete"))}))}),[c]),i=r.useCallback((function(e){var t=e.selected,n=e.onChangeSelected;return function(e){var a=e.rowIndex,l=e.rowData,o=t.includes(a);return r.createElement(f.Flex,null,r.createElement(f.Box,{flex:"0 1 auto"},r.createElement("label",null,r.createElement(u.f,{checked:o,onChange:function(){return n(a,!o)}}))),r.createElement(f.Box,{ml:3,flex:"1"},r.createElement(u.y,{variant:"bodySecondary"},l.role)))}}),[]),m=r.useCallback((function(){return function(e){var t=e.rowData,a=Object.values(n).filter((function(e){return-1!==e.roles.indexOf(t.role)}));return 0===a.length?r.createElement(u.y,{variant:"bodySecondary"},"No users currently have this role"):a.length<3?r.createElement(u.y,{variant:"bodySecondary"},a.map((function(e){return e.username})).join(" and ")):r.createElement(u.y,{variant:"bodySecondary"},a.slice(0,2).map((function(e){return e.username})).join(", "),r.createElement("b",null," +",a.length-2," more"))}}),[n]),p=r.useCallback((function(){return function(e){var t=e.rowData;if(!t)return null;var a=Object.values(n).filter((function(e){return-1!==e.roles.indexOf(t.role)}));return r.createElement(f.Flex,{flexDirection:"row-reverse",mr:-1},r.createElement(h.a,{resource:E.d.Roles,action:E.a.Delete,yes:0===a.length?r.createElement(b.a,{content:"Delete"},r.createElement(u.d,{mx:1,onClick:function(){c([t])},variant:"icon"},r.createElement(u.j,{icon:"trash-alt"}))):r.createElement(f.Box,{mx:1,flex:"0 0 40px"})}),r.createElement(h.a,{resource:E.d.Roles,action:E.a.Update,yes:r.createElement(b.a,{content:"Edit"},r.createElement(u.d,{mx:1,onClick:function(){o(t)},variant:"icon"},r.createElement(u.j,{icon:"edit"})))}))}}),[n,o,c]);return r.createElement(v.a,{total:a,bulkActionsRenderer:s,data:t,resource:E.d.Roles,onLoadMoreRows:l},(function(e){return[r.createElement(d.d,{key:"role",cellDataGetter:function(){},flexGrow:2,width:2/6,dataKey:"role",label:"Role",cellRenderer:i(e)}),r.createElement(d.d,{key:"description",cellDataGetter:function(){},flexGrow:3,width:2/6,dataKey:"role",label:"Description",cellRenderer:function(e){var t=e.rowData;return r.createElement(u.y,{variant:"bodySecondary"},t.description||"No description")}}),r.createElement(d.d,{key:"users",cellDataGetter:function(){},flexGrow:3,width:1/6,dataKey:"role",label:"Users",cellRenderer:m()}),r.createElement(d.d,{key:"role",cellDataGetter:function(){},flexGrow:1,width:1/6,dataKey:"role",label:"",cellRenderer:p()})]}))}function x(e){var t=e.roles,n=e.users,a=e.total,o=e.onLoadMoreRows,c=e.onFetchUsers,s=e.onDeleteRole,i=Object(l.g)().push,d=r.useCallback((function(e){return i("/roles/".concat(e.role))}),[i]);return r.useEffect((function(){o({search:"",offset:0,limit:0}),c({search:"",offset:0,limit:0})}),[o,c]),r.createElement(m.a,{title:"Roles",rightContent:r.createElement(u.d,{variant:"primary",large:!0,onClick:function(){return i("/roles/create")},mr:4},"Create new role")},r.createElement(p,{roles:t,users:n,total:a,onLoadMoreRows:o,onEdit:d,onDelete:s}))}var y={onFetchUsers:i.c.request,onFetchRoles:s.d.request,onDeleteRole:s.a.request};var g=Object(o.b)((function(e){return{roles:e.roles.roles,users:e.users.users,total:e.roles.total,userRole:e.auth.role}}),y)((function(e){var t=Object(c.f)(s.d);return r.createElement(x,Object.assign({},e,{onLoadMoreRows:t}))})),w=n(22),C=n(6),R=n(7),j=n(654),O=n(419);function k(e){return a.a.createElement(u.d,Object.assign({variant:"icon",color:"neutral_8"},e),a.a.createElement(u.j,{icon:["fas","arrow-left"]}))}var D,F=n(81),S=n(14);function U(e,t){return[].concat(Object(S.a)(e?["read:any"]:[]),Object(S.a)(t?["create:any","update:any","delete:any"]:[]))}function B(e){var t=e.value,n=e.permission,a=e.onChange,l=t.includes("read:any"),o=t.includes("create:any");return r.createElement(f.Flex,{py:3},r.createElement(f.Box,{flex:4,width:4/6},r.createElement(u.y,null,n.label)),r.createElement(f.Box,{flex:1,width:1/6},!n.cannotView&&r.createElement("label",null,r.createElement(u.f,{checked:l,onChange:function(){return a(U(!l,o))}}))),r.createElement(f.Box,{flex:1,width:1/6},!n.cannotModify&&r.createElement("label",null,r.createElement(u.f,{checked:o,onChange:function(){return a(U(l,!o))}}))))}function q(e){var t=e.value,n=e.onChange,a=e.permissions;return r.createElement(f.Box,null,r.createElement(f.Flex,{py:3},r.createElement(f.Box,{flex:4,width:4/6},r.createElement(u.i,{variant:"h3"},"Permissions")),r.createElement(f.Box,{flex:1,width:1/6},r.createElement(u.i,{variant:"h3"},"View")),r.createElement(f.Box,{flex:1,width:1/6},r.createElement(u.i,{variant:"h3"},"Modify"))),a.map((function(e){return r.createElement(B,{key:e.resource,permission:e,value:t[e.resource]||[],onChange:function(r){return n(Object(C.a)({},t,{[e.resource]:r}))}})})))}!function(e){e[e.Permissions=0]="Permissions",e[e.Users=1]="Users"}(D||(D={}));var M={role:"",description:"",is_default:!1,grants:{}};function _(e){var t=e.users,n=e.role,a=e.onSaveRole,o=e.onUpdateRole,c=e.onFetchUsers,s=e.permissions,i=Object(l.g)().push,d=r.useState(n||M),E=Object(R.a)(d,2),h=E[0],v=E[1],b=r.useState([]),p=Object(R.a)(b,2),x=p[0],y=p[1],g=r.useState(D.Users),w=Object(R.a)(g,2),S=w[0],U=w[1],B=r.useCallback((function(e){return v(Object(C.a)({},h,{},e))}),[h]);r.useEffect((function(){c({search:"",limit:0,offset:0})}),[c]),r.useEffect((function(){n&&v(n)}),[n]),r.useEffect((function(){y(Object.values(t).filter((function(e){return n&&-1!==e.roles.indexOf(n.role)})).map((function(e){return{label:e.username,value:e.username,data:e}})))}),[n,t,t.length]);var _=r.useMemo((function(){return Object.values(t).map((function(e){return{label:e.username,value:e.username,data:e}}))}),[t]);return r.createElement(m.a,{scrollable:!0,title:r.createElement(r.Fragment,null,r.createElement(k,{onClick:function(){return i("/roles")}})," ",n?"Edit":"Create new"," ","Role"),rightContent:r.createElement(f.Flex,{mr:-2,pr:4,flexDirection:"row-reverse"},r.createElement(u.d,{variant:"primary",onClick:function(){var e=x.map((function(e){return e.data})),t=function(){i("/roles")},r=Object(C.a)({},h,{is_default:!!h.is_default});n?o({currentId:n.role,role:r,users:e,onSaved:t}):a({role:r,users:e,onSaved:t})},large:!0,mr:2},n?"Save":"Create"," role"),r.createElement(u.d,{variant:"secondary",onClick:function(){return i("/roles")},large:!0,mr:2},n?"Cancel":"Discard"))},r.createElement(f.Box,{width:2/3,m:"0 auto"},r.createElement(u.e,{sx:{borderRadius:"large"},p:6,mb:6},r.createElement(u.i,{variant:"h2",mb:4},"Basic Details"),r.createElement(f.Box,{mb:4,width:"100%"},r.createElement(F.a,{text:"Name"},r.createElement(u.l,{value:h.role,onChangeValue:function(e){return B({role:e})},fullWidth:!0,placeholder:"Role title",autoFocus:!0}))),r.createElement(f.Box,{mb:4,width:"100%"},r.createElement(F.a,{text:"Description"},r.createElement(u.l,{value:h.description||"",onChangeValue:function(e){return B({description:e})},fullWidth:!0,placeholder:"Access chat logs, analyze and define requirements for updates"}))),r.createElement(f.Flex,{as:"label",alignItems:"center"},r.createElement(u.f,{checked:h.is_default||!1,onChange:function(e){return B({is_default:!h.is_default})},mr:2}),r.createElement(u.y,null,"Set as default roles"))),r.createElement(u.e,{sx:{borderRadius:"large"},p:6},r.createElement(j.a,{justifyContent:"flex-start",ml:-3,mb:4},r.createElement(O.a,{variant:"h2",active:S===D.Permissions,onClick:function(){return U(D.Permissions)}},"Add Permissions"),r.createElement(O.a,{variant:"h2",active:S===D.Users,onClick:function(){return U(D.Users)}},"Add Users")),S===D.Permissions&&r.createElement(q,{permissions:s,value:h.grants,onChange:function(e){return B({grants:e})}}),S===D.Users&&r.createElement(F.a,{text:"Add users to this Role"},r.createElement(u.p,{placeholder:"Search users...",items:_,onChange:function(e){y(Array.isArray(e)?e:[])},value:x})))))}var G={onSaveRole:s.f.request,onUpdateRole:s.g.request,onFetchUsers:i.c.request,onFetchRole:s.b.request,onFetchRoleUsers:s.c.request};var A=Object(o.b)((function(e){return{users:e.users.users,permissions:e.roles.permissions,roles:e.roles.roles}}),G)((function(e){var t=e.roles,n=e.onFetchRoleUsers,a=e.onFetchRole,o=Object(w.a)(e,["roles","onFetchRoleUsers","onFetchRole"]),c=Object(l.i)().params.roleName;r.useEffect((function(){c&&(a(c),n(c))}),[a,n,c]);var s=r.useMemo((function(){if(c)return Object.values(t).find((function(e){return e.role===c}))}),[c,t]);return r.createElement(r.Fragment,null,r.createElement(_,Object.assign({role:s},o)))}));function P(e){var t=Object(c.h)();r.useEffect((function(){t("view:roles:loaded")}),[t]);var n=Object(l.i)();return r.createElement(l.e,null,r.createElement(l.c,{exact:!0,path:n.path,component:g}),r.createElement(l.c,{exact:!0,path:"".concat(n.path,"/create"),component:A}),r.createElement(l.c,{exact:!0,path:"".concat(n.path,"/:roleName"),component:A}))}}}]);