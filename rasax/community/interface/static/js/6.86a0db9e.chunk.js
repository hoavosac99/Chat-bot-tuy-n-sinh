(this["webpackJsonprasa-frontend"]=this["webpackJsonprasa-frontend"]||[]).push([[6],{1597:function(e,r,t){"use strict";t.r(r);var n=t(0),l=t(21),a=t(2),o=t(167),c=t(113),s=t(43),u=t(68),i=t(3),f=t(23),d=t(96),m=t(50),h=t(1),v=t(8),w=t(30),y=t(390),E=t(166);function b(e){return null!==e}function p(e){var r=e.onDelete,t=e.onLoadMoreRows,l=e.onSaveUserRoles,a=e.onSearch,o=e.roles,c=e.searchQuery,s=e.total,u=e.unfilteredTotal,f=e.users,d=n.useCallback((function(e,r){return n.createElement(y.a,{p:4,name:"Roles",items:o.map((function(e){return e.role})),checkedItems:e.filter((function(e){return"role"===e.keyword})).map((function(e){return e.value})),onChange:function(t){return r(e.filter((function(e){return"role"!==e.keyword})).concat(t.map((function(e){return{keyword:"role",value:e,negated:!1}}))))}})}),[o]),p=n.useMemo((function(){return{keyword:"role",values:o.map((function(e){return{label:e.role,total:e.users_count||0}})),clear:!0,all:"All",total:u}}),[o,u]),R=n.useCallback((function(e){var r=e.selected,t=e.onChangeSelected;return function(e){var l=e.rowIndex,a=e.rowData;if(!a)return null;var o=r.includes(l);return n.createElement(i.Flex,{alignItems:"center"},n.createElement(i.Box,{flex:"0 1 auto",mr:3},n.createElement("label",null,n.createElement(h.f,{checked:o,onChange:function(){return t(l,!o)}}))),n.createElement(i.Box,{flex:"1",style:{overflow:"hidden",textOverflow:"ellipsis"}},n.createElement(h.y,{variant:"bodySecondary"},a.username)))}}),[]),k=function(e){var r=e.rowData,t=e.rowIndex,a=r;if(!a)return null;var c=o.map((function(e){return{label:e.role,value:e.role,data:e}})),s=o.reduce((function(e,r){return e[r.role]=r,e}),{}),u=a.roles.map((function(e){var r=s[e];return r?{label:r.role,value:r.role,data:r}:null})).filter(b);return n.createElement(h.p,{placeholder:"Search roles...",fullWidth:!0,items:c,onChange:function(e){Array.isArray(e)&&l({userIndex:t,user:a,roles:e.map((function(e){return e.data}))})},value:u})},x=function(e){var t=e.rowData;return t?n.createElement(i.Flex,{flexDirection:"row-reverse",mr:-1},n.createElement(w.a,{resource:v.d.Users,action:v.a.Delete,yes:n.createElement(h.d,{mr:1,variant:"icon",onClick:function(){r([t])}},n.createElement(h.j,{icon:"trash-alt"}))})):null};return n.createElement(E.a,{bulkActionsRenderer:function(e){var t=e.dataSelected,l=e.setSelected;return n.createElement(w.a,{resource:v.d.Users,action:v.a.Delete,yes:n.createElement(h.d,{onClick:function(){r(t),l([])},variant:"inverse"},"Delete")})},data:f,filtersRenderer:d,quickFilters:p,onLoadMoreRows:t,onSearch:a,resource:v.d.User,searchQuery:c,total:s},(function(e){return[n.createElement(m.d,{key:"model",cellDataGetter:function(){},flexGrow:2,width:300,dataKey:"username",label:"User",className:"ReactVirtualized__Table__rowColumn_overflow",cellRenderer:R(e)}),n.createElement(m.d,{key:"type",cellDataGetter:function(){},flexGrow:3,width:450,dataKey:"roles",label:"Roles",cellRenderer:k}),n.createElement(m.d,{key:"actions",cellDataGetter:function(){},flexGrow:1,width:150,dataKey:"username",className:"ReactVirtualized__Table__rowColumnOnHover",label:"",cellRenderer:x})]}))}function R(e){var r=e.onDelete,t=e.onFetchRoles,l=e.onFetchUsers,a=e.onLoadMoreRows,o=e.onSaveUserRoles,c=e.roles,s=e.searchQuery,u=e.total,m=e.users,h=e.unfilteredTotal,v=Object(f.h)();n.useEffect((function(){v("view:users:loaded")}),[v]),n.useEffect((function(){t({search:"",offset:0,limit:0}),l({search:s,offset:0,limit:20})}),[t,l,s]);var w=n.useCallback((function(e){return l({search:e,offset:0,limit:20})}),[l]),y=Object.values(c);return n.createElement(d.a,{title:"Users"},n.createElement(i.Flex,{flexDirection:"column",style:{height:"100%"}},n.createElement(i.Box,{flex:"1"},n.createElement(p,{roles:y,total:u,users:m,unfilteredTotal:h,onDelete:r,onLoadMoreRows:a,onSearch:w,searchQuery:s,onSaveUserRoles:o}))))}var k={onFetchUsers:s.c.request,onDelete:s.a.request,onFetchRoles:u.d.request,onSaveUserRoles:s.d.request};r.default=Object(l.b)((function(e){return{users:e.users.users,total:e.users.total,searchQuery:e.users.searchQuery,roles:e.roles.roles,unfilteredTotal:e.users.unfilteredTotal}}),k)((function(e){return n.createElement(o.a,{listener:c.b,start:Object(a.getType)(s.c.request),resolve:Object(a.getType)(s.c.success),reject:Object(a.getType)(s.c.failure)},(function(r){return n.createElement(R,Object.assign({},e,{onLoadMoreRows:r}))}))}))}}]);